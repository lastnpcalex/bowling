<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Bowling Scoresheet</title>
    <link rel="stylesheet" href="styles.css">
    
          
    <style>
        body {
            background-color: #0d0d0d;
            color: #00ff99;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            box-shadow: 0 0 20px #00ccff, 0 0 30px #00ff99;
        }
        h1, h2 {
            text-align: center;
            font-size: 2.5rem;
            color: #00ccff;
            text-shadow: 0 0 5px #00ccff, 0 0 10px #00ccff;
        }
        h2 {
            font-size: 2rem;
            margin-top: 20px;
        }
        .instructions {
            text-align: center;
            margin-bottom: 20px;
            color: #00ccff;
        }
        .score-sheet {
            margin-top: 20px;
            background-color: #0d0d0d;
            padding: 10px;
            overflow-x: auto;
        }
        .frames-container {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            border: 1px solid #00ff99;
        }
        .frame {
            border: 1px solid #00ff99;
            border-right: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-sizing: border-box;
            width: 60px;
            height: 60px;
            margin-right: -1px;
        }
        .frame:nth-child(10) {
            border-right: 1px solid #00ff99;
            width: 90px;
        }
        .frame-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 2px;
            box-sizing: border-box;
            height: 60%;
            border-bottom: 1px solid #00ff99;
        }
        .frame-bottom {
            text-align: center;
            font-size: 18px;
            padding: 2px;
            box-sizing: border-box;
            height: 40%;
        }
        .roll1, .roll2, .roll3 {
            font-size: 18px;
            color: #00ff99;
            width: 20px;
            text-align: center;
        }
        .roll2, .roll3 {
            border-left: 1px solid #00ff99;
        }
        .strike {
            background-color: #ff0000;
            color: #fff;
        }
        .spare {
            background-color: #00ff00;
            color: #000;
        }
        #input-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #roll-info {
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #00ccff;
        }
        #input-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 300px;
        }
        #input-buttons button {
            width: 40px;
            height: 40px;
            padding: 5px;
            margin: 3px;
            font-size: 14px;
            background-color: #00ff99;
            color: #0d0d0d;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #input-buttons button:hover {
            background-color: #00ccff;
        }
        .frame.selected {
            box-shadow: 0 0 10px #00ff99;
        }
        #game-label {
            margin-top: 20px;
            text-align: center;
        }
        #game-label input {
            margin-top: 10px;
            background-color: #1a1a1a;
            color: #00ff99;
            border: 2px solid #00ff99;
            padding: 5px;
            border-radius: 5px;
        }
        #download-button, #file-input-container label {
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #00ff99;
            color: #0d0d0d;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #download-button:hover, #file-input-container label:hover {
            background-color: #00ccff;
        }
        #file-input-container {
            margin-top: 20px;
            text-align: center;
        }
        #file-input-container input[type="file"] {
            display: none;
        }
    </style>

</head>
<body>
    <div class="container">
        <h1>Interactive Bowling Scoresheet</h1>
        <div class="instructions">
            <p>Click a frame to enter a score. To edit a frame, click it and enter a new score.</p>
        </div>
        <div id="scoresheet" class="score-sheet">
            <div class="frames-container">
                <!-- Frames will be dynamically added here -->
            </div>
        </div>
        <div id="input-area" style="display: none;">
            <div id="roll-info"></div>
            <div id="input-buttons"></div>
        </div>
        <div id="game-label">
            <label for="game-name">Game Label:</label>
            <input type="text" id="game-name" value="">
            <button id="download-button">Download Game Data</button>
        </div>
        <div id="file-input-container">
            <label for="load-game">Load Game from JSON</label>
            <input type="file" id="load-game" accept=".json">
        </div>
    </div>


<script>
const scoresheet = document.getElementById('scoresheet');
const inputArea = document.getElementById('input-area');
const inputButtons = document.getElementById('input-buttons');
const rollInfo = document.getElementById('roll-info');
const framesContainer = scoresheet.querySelector('.frames-container');
const gameNameInput = document.getElementById('game-name');
const downloadButton = document.getElementById('download-button');
let currentFrame = 0;
let currentRoll = 0;
let gameScores = Array(10).fill().map(() => ({ rolls: [], score: 0 }));
let gameComplete = false;

function createFrames() {
    for (let i = 0; i < 10; i++) {
        const frame = document.createElement('div');
        frame.className = `frame ${i === 9 ? 'tenth-frame' : ''}`;
        frame.innerHTML = `
            <div class="frame-top">
                <span class="roll1"></span>
                <span class="roll2"></span>
                ${i === 9 ? '<span class="roll3"></span>' : ''}
            </div>
            <div class="frame-bottom"></div>
        `;
        frame.addEventListener('click', () => selectFrame(i));
        framesContainer.appendChild(frame);
    }
}

function selectFrame(frameIndex) {
    currentFrame = frameIndex;
    const frame = gameScores[currentFrame];

    if (frameIndex === 9) {
        // For 10th frame, set currentRoll based on the number of rolls entered
        currentRoll = Math.min(frame.rolls.length, 2);
        gameComplete = false; // Reset game complete status when selecting 10th frame
    } else {
        currentRoll = 0;
    }

    updateInputOptions();
    inputArea.style.display = "flex";

    document.querySelectorAll(".frame").forEach((f) => f.classList.remove("selected"));
    framesContainer.children[frameIndex].classList.add("selected");
}

function updateInputOptions() {
    inputButtons.innerHTML = ""; // Clear existing buttons
    let maxPins = 10;
    let rollText = "";

    const frame = gameScores[currentFrame];
    const rolls = frame.rolls;

    if (currentFrame === 9) {
        // 10th frame logic
        if (currentRoll === 0) {
            rollText = "10th Frame - 1st Roll";
        } else if (currentRoll === 1) {
            rollText = "10th Frame - 2nd Roll";
            if (rolls[0] < 10) {
                maxPins = 10 - rolls[0];
            }
        } else if (currentRoll === 2) {
            rollText = "10th Frame - 3rd Roll";
            if (rolls[0] === 10) {
                if (rolls[1] === 10) {
                    maxPins = 10;
                } else {
                    maxPins = 10 - rolls[1];
                }
            } else if (rolls[0] + rolls[1] === 10) {
                maxPins = 10;
            } else {
                inputArea.style.display = "none";
                return;
            }
        }
    } else {
        // Frames 1-9 logic
        if (currentRoll === 0) {
            rollText = `Frame ${currentFrame + 1} - 1st Roll`;
        } else {
            rollText = `Frame ${currentFrame + 1} - 2nd Roll`;
            maxPins = 10 - rolls[0];
        }
    }

    rollInfo.textContent = rollText;

    for (let i = 0; i <= maxPins; i++) {
        const button = document.createElement("button");
        button.textContent = i === 10 ? "X" : i;
        button.addEventListener("click", () => handleRoll(i));
        if (rolls[currentRoll] === i) {
            button.classList.add("selected");
        }
        inputButtons.appendChild(button);
    }

    // Add spare button for 2nd roll in frames 1-9 and 2nd and 3rd rolls in 10th frame when appropriate
    if ((currentRoll === 1 && currentFrame < 9) || (currentFrame === 9 && (currentRoll === 1 || currentRoll === 2))) {
        if (maxPins > 0 && maxPins < 10) {
            const spareButton = document.createElement("button");
            spareButton.textContent = "/";
            spareButton.addEventListener("click", () => handleRoll(maxPins));
            if (rolls[currentRoll] === maxPins) {
                spareButton.classList.add("selected");
            }
            inputButtons.appendChild(spareButton);
        }
    }

    // Add "Next Roll" button for 10th frame
    if (currentFrame === 9 && currentRoll < 2 && rolls.length > currentRoll) {
        const nextRollButton = document.createElement("button");
        nextRollButton.textContent = "Next Roll";
        nextRollButton.addEventListener("click", () => {
            currentRoll++;
            updateInputOptions();
        });
        inputButtons.appendChild(nextRollButton);
    }
}

function handleRoll(pins) {
    const frame = gameScores[currentFrame];
    frame.rolls[currentRoll] = pins;

    updateFrameDisplay(currentFrame);

    if (currentFrame === 9) {
        // 10th frame logic
        if (currentRoll < 2) {
            currentRoll++;
        } else {
            gameComplete = true;
        }

        // Check if 3rd roll is allowed
        if (currentRoll === 2 && (frame.rolls[0] === 10 || frame.rolls[0] + frame.rolls[1] === 10)) {
            gameComplete = false;
        } else if (currentRoll === 2) {
            gameComplete = true;
        }
    } else {
        // Frames 1-9 logic
        if (pins === 10 || currentRoll === 1) {
            currentFrame++;
            currentRoll = 0;
        } else {
            currentRoll = 1;
        }
    }

    if (!gameComplete) {
        updateInputOptions();
    } else {
        inputArea.style.display = "none";
    }

    calculateScores();
}

function updateFrameDisplay(frameIndex) {
    const frame = framesContainer.children[frameIndex];
    const rolls = gameScores[frameIndex].rolls;
    const rollDisplays = frame.querySelectorAll('.roll1, .roll2, .roll3');

    rollDisplays.forEach((display, index) => {
        if (rolls[index] !== undefined) {
            if (rolls[index] === 10) {
                display.textContent = 'X';
            } else if ((index === 1 && rolls[0] + rolls[1] === 10) ||
                       (frameIndex === 9 && index === 2 && rolls[1] + rolls[2] === 10 && rolls[1] !== 10)) {
                display.textContent = '/';
            } else {
                display.textContent = rolls[index];
            }
        } else {
            display.textContent = '';
        }
    });

    frame.querySelector('.frame-bottom').textContent = gameScores[frameIndex].score || '';
}

function calculateScores() {
    let totalScore = 0;
    for (let i = 0; i < 10; i++) {
        const frame = gameScores[i];
        const rolls = frame.rolls;

        if (i < 9) {
            if (rolls[0] === 10) { // Strike
                frame.score = 10 + (gameScores[i+1].rolls[0] || 0) + 
                              ((gameScores[i+1].rolls[1] !== undefined) ? gameScores[i+1].rolls[1] : 
                               (gameScores[i+2] && gameScores[i+2].rolls[0]) || 0);
            } else if (rolls[0] + rolls[1] === 10) { // Spare
                frame.score = 10 + (gameScores[i+1].rolls[0] || 0);
            } else { // Open frame
                frame.score = (rolls[0] || 0) + (rolls[1] || 0);
            }
        } else { // 10th frame
            frame.score = (rolls[0] || 0) + (rolls[1] || 0) + (rolls[2] || 0);
        }

        totalScore += frame.score;
        frame.score = totalScore;
        updateFrameDisplay(i);
    }
}

function setDefaultGameName() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const defaultName = `Game_${year}-${month}-${day}`;
    gameNameInput.value = defaultName;
}

function initializeGame() {
    createFrames();
    setDefaultGameName();
    selectFrame(0);
}

document.addEventListener('DOMContentLoaded', initializeGame);

downloadButton.addEventListener('click', () => {
    const gameData = JSON.stringify(gameScores);
    const blob = new Blob([gameData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${gameNameInput.value}.json`;
    a.click();
    URL.revokeObjectURL(url);
});

document.getElementById('load-game').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const loadedGameScores = JSON.parse(e.target.result);
                if (Array.isArray(loadedGameScores) && loadedGameScores.length === 10) {
                    gameScores = loadedGameScores;
                    gameComplete = gameScores[9].rolls.length === 3 || 
                                   (gameScores[9].rolls.length === 2 && gameScores[9].rolls[0] + gameScores[9].rolls[1] < 10);
                    currentFrame = gameComplete ? 9 : gameScores.findIndex(frame => frame.rolls.length < 2);
                    currentRoll = gameScores[currentFrame].rolls.length;
                    calculateScores();
                    for (let i = 0; i < 10; i++) {
                        updateFrameDisplay(i);
                    }
                    selectFrame(currentFrame);
                } else {
                    alert('Invalid game data format');
                }
            } catch (error) {
                alert('Error loading game data');
                console.error(error);
            }
        };
        reader.readAsText(file);
    }
});
</script>




</body>
</html>
